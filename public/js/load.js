$(document).ready(function(){
    //localStorage['board'] = "[{\"id\":\"_bsh0zx8nw\",\"name\":\"Нова дошка\",\"lists\":[{\"id\":\"_fg6isgx0c\",\"name\":\"Треба зробити\",\"created\":\"2024-03-22T16:06:29.132Z\",\"tiles\":[{\"id\":\"_zwwvigvn0\",\"created\":\"2024-03-22T16:06:39.299Z\",\"name\":\"Нова задача\",\"date\":\"2024-03-20T16:06:31.044Z\",\"employes\":[\"590207b0950b6f6a\",\"b5013c9414908fcb\"],\"responsible\":[\"e4ab551c6ceed5d2\",\"814948dddfa89388\"],\"description\":\"dfdf\",\"tags\":[\"#6833ff\",\"#60e830\"],\"expired\":false}],\"background\":\"\",\"color\":\"\",\"removable\":false},{\"id\":\"_tjia9kcco\",\"name\":\"Робиться\",\"created\":\"2024-03-22T16:06:29.132Z\",\"tiles\":[],\"background\":\"\",\"color\":\"\",\"removable\":false},{\"id\":\"_qj8ni62rc\",\"name\":\"Готово\",\"created\":\"2024-03-22T16:06:29.132Z\",\"tiles\":[],\"background\":\"\",\"color\":\"\",\"removable\":false}],\"created\":\"2024-03-22T16:06:29.131Z\",\"users\":[{\"results\":[{\"gender\":\"female\",\"name\":{\"title\":\"Miss\",\"first\":\"Silje\",\"last\":\"Poulsen\"},\"location\":{\"street\":{\"number\":9163,\"name\":\"Skrænten\"},\"city\":\"Rønnede\",\"state\":\"Sjælland\",\"country\":\"Denmark\",\"postcode\":87112,\"coordinates\":{\"latitude\":\"-46.4553\",\"longitude\":\"149.7282\"},\"timezone\":{\"offset\":\"-10:00\",\"description\":\"Hawaii\"}},\"email\":\"silje.poulsen@example.com\",\"login\":{\"uuid\":\"dd31ebbb-dc3e-4cc4-a4d7-43e1dfd5cbcf\",\"username\":\"heavyelephant270\",\"password\":\"ssss\",\"salt\":\"Uo6VWrxq\",\"md5\":\"8e13c2b37fafbb13a6ef1332c9d1557d\",\"sha1\":\"8392613e1b68fd00c67c8a48b688b0625c5c8cf9\",\"sha256\":\"50173e744148652d79ad31d8198c69dcc409ebf955e1d5bc503297a06e29bf59\"},\"dob\":{\"date\":\"1995-05-16T07:15:32.669Z\",\"age\":28},\"registered\":{\"date\":\"2003-09-09T01:10:27.130Z\",\"age\":20},\"phone\":\"98377793\",\"cell\":\"38941842\",\"id\":{\"name\":\"CPR\",\"value\":\"160595-6036\"},\"picture\":{\"large\":\"https://randomuser.me/api/portraits/women/80.jpg\",\"medium\":\"https://randomuser.me/api/portraits/med/women/80.jpg\",\"thumbnail\":\"https://randomuser.me/api/portraits/thumb/women/80.jpg\"},\"nat\":\"DK\"}],\"info\":{\"seed\":\"e4ab551c6ceed5d2\",\"results\":1,\"page\":1,\"version\":\"1.4\"}},{\"results\":[{\"gender\":\"male\",\"name\":{\"title\":\"Mr\",\"first\":\"Célestin\",\"last\":\"Dupont\"},\"location\":{\"street\":{\"number\":1070,\"name\":\"Avenue Tony-Garnier\"},\"city\":\"Pau\",\"state\":\"Landes\",\"country\":\"France\",\"postcode\":13797,\"coordinates\":{\"latitude\":\"-18.1172\",\"longitude\":\"-61.2432\"},\"timezone\":{\"offset\":\"-10:00\",\"description\":\"Hawaii\"}},\"email\":\"celestin.dupont@example.com\",\"login\":{\"uuid\":\"23111a80-f252-45b0-94a0-d03ad3a4badf\",\"username\":\"redbear855\",\"password\":\"corleone\",\"salt\":\"9ivjuTcg\",\"md5\":\"0f03828a06e798a71aa85a480fe58301\",\"sha1\":\"a8fcf3472cd8a96073b693250210d1ee3f881d93\",\"sha256\":\"901e93d0485a74f2d5634c3407f5a16e22ce336b224b95f9b19a235ef1d25080\"},\"dob\":{\"date\":\"1947-11-21T23:53:53.207Z\",\"age\":76},\"registered\":{\"date\":\"2006-09-22T16:14:37.899Z\",\"age\":17},\"phone\":\"05-26-27-68-95\",\"cell\":\"06-59-39-77-78\",\"id\":{\"name\":\"INSEE\",\"value\":\"1471013518316 30\"},\"picture\":{\"large\":\"https://randomuser.me/api/portraits/men/65.jpg\",\"medium\":\"https://randomuser.me/api/portraits/med/men/65.jpg\",\"thumbnail\":\"https://randomuser.me/api/portraits/thumb/men/65.jpg\"},\"nat\":\"FR\"}],\"info\":{\"seed\":\"814948dddfa89388\",\"results\":1,\"page\":1,\"version\":\"1.4\"}},{\"results\":[{\"gender\":\"female\",\"name\":{\"title\":\"Ms\",\"first\":\"Emilia\",\"last\":\"Saarinen\"},\"location\":{\"street\":{\"number\":4526,\"name\":\"Nordenskiöldinkatu\"},\"city\":\"Sottunga\",\"state\":\"Ostrobothnia\",\"country\":\"Finland\",\"postcode\":52301,\"coordinates\":{\"latitude\":\"-23.1459\",\"longitude\":\"78.0680\"},\"timezone\":{\"offset\":\"+4:00\",\"description\":\"Abu Dhabi, Muscat, Baku, Tbilisi\"}},\"email\":\"emilia.saarinen@example.com\",\"login\":{\"uuid\":\"3dd977d7-7f48-4888-beed-ca1e4a9ff1d0\",\"username\":\"smallsnake701\",\"password\":\"ttttttt\",\"salt\":\"9sFHIIS6\",\"md5\":\"f6a55a7ab23854f9d542234c1720a0fe\",\"sha1\":\"eb44e88d9bb97f1f4556baa5399e25b67b535124\",\"sha256\":\"778f1732b605bbb91ad75e5aebc9805915bfb3157897abea515266d837de61eb\"},\"dob\":{\"date\":\"1950-07-31T02:23:10.867Z\",\"age\":73},\"registered\":{\"date\":\"2021-01-19T08:53:31.238Z\",\"age\":3},\"phone\":\"07-599-180\",\"cell\":\"042-051-89-27\",\"id\":{\"name\":\"HETU\",\"value\":\"NaNNA234undefined\"},\"picture\":{\"large\":\"https://randomuser.me/api/portraits/women/24.jpg\",\"medium\":\"https://randomuser.me/api/portraits/med/women/24.jpg\",\"thumbnail\":\"https://randomuser.me/api/portraits/thumb/women/24.jpg\"},\"nat\":\"FI\"}],\"info\":{\"seed\":\"590207b0950b6f6a\",\"results\":1,\"page\":1,\"version\":\"1.4\"}},{\"results\":[{\"gender\":\"male\",\"name\":{\"title\":\"Monsieur\",\"first\":\"Bekim\",\"last\":\"Leroux\"},\"location\":{\"street\":{\"number\":1878,\"name\":\"Rue Victor-Hugo\"},\"city\":\"Münchwilen (Tg)\",\"state\":\"Jura\",\"country\":\"Switzerland\",\"postcode\":9247,\"coordinates\":{\"latitude\":\"-63.6572\",\"longitude\":\"-62.3236\"},\"timezone\":{\"offset\":\"+2:00\",\"description\":\"Kaliningrad, South Africa\"}},\"email\":\"bekim.leroux@example.com\",\"login\":{\"uuid\":\"1983f96d-be3d-404d-85e6-2e96ef4cd487\",\"username\":\"whitekoala214\",\"password\":\"emilia\",\"salt\":\"R4mYcr2t\",\"md5\":\"42a8e2eccb7fda353625a8eae54e473a\",\"sha1\":\"900910866192b150f602213e8f00ba387bd46849\",\"sha256\":\"9bba446620f6c76c8a400fc281bdb2bebac777e9f5246cec9e485aab86e85d41\"},\"dob\":{\"date\":\"1994-12-30T00:27:02.915Z\",\"age\":29},\"registered\":{\"date\":\"2014-01-18T23:10:58.124Z\",\"age\":10},\"phone\":\"079 278 25 44\",\"cell\":\"075 715 89 42\",\"id\":{\"name\":\"AVS\",\"value\":\"756.5589.5576.83\"},\"picture\":{\"large\":\"https://randomuser.me/api/portraits/men/42.jpg\",\"medium\":\"https://randomuser.me/api/portraits/med/men/42.jpg\",\"thumbnail\":\"https://randomuser.me/api/portraits/thumb/men/42.jpg\"},\"nat\":\"CH\"}],\"info\":{\"seed\":\"b5013c9414908fcb\",\"results\":1,\"page\":1,\"version\":\"1.4\"}}],\"background\":\"var(--board-bg1)\",\"tags\":[\"#ff3333\",\"#6833ff\",\"#60e830\",\"#e8d530\"]}]";
    const boards = $('.menu-bar-content').find('.content');
    const savedBoards = localStorage['board'] !== undefined;
    if(savedBoards){ console.log(JSON.parse(localStorage['board'])); loadBoards(boards);}

    const addNewBoardBtn = $('<div>').addClass('btn-add-board').attr('id','plus-board').html(($('<i>').addClass('bx bx-plus')[0]));
    boards.append(addNewBoardBtn);

});

function fillTagColors(){
    localStorage['tag-colors'] = JSON.stringify(['rgb(22, 75, 53)', 'rgb(159, 121, 7)','rgb(188, 77, 0)','rgb(169, 56, 47)','rgb(73, 60, 137)','rgb(12, 67, 146)']);
}

function getBoardData(id){
    const storage = JSON.parse(localStorage['board']);
    const data = storage.find(obj => obj.id === id);
    return data;
}

function loadBoards(body){
    const boards = JSON.parse(localStorage['board']);
    
    for(let i = 0; i < boards.length; i++){
        body.append(createBoardItem(boards[i]));
    }
}

function loadLists(filterTags = []){
    const boardID = localStorage['selected-board'];
    const storage = JSON.parse(localStorage['board']);
    const boardData = storage.find(obj => obj.id === boardID);
    const listsBody = $('#lists');
    listsBody.html('');
    const listsData = boardData.lists;
    for(let i = 0; i < listsData.length; i++){
        const list = listsData[i];
        const tiles = list.tiles;

        const listItem = createListItem(list);
    
        for(let j = 0; j < tiles.length; j++){
            const tile = tiles[j];
            if(filterTags.length > 0){
                if(tile.tags.some(item => filterTags.includes(item))){
                    listItem.find('.list-content').append(createTileItem(tile));
                }
            } else{
                listItem.find('.list-content').append(createTileItem(tile));
            }
        }

        listsBody.append(listItem);
    }
    
}

$(document).on('click','#show-all-boards-json', function(){
    console.log(JSON.parse(localStorage['board']));
});

$(document).on('click','#clear-storage', function(){
    localStorage.clear();
    sendToastMsg('Сховище очищено!', 'info', true);
});